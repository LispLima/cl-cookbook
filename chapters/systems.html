<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Defining Systems &#8212; The Common Lisp Cookbook 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="The Common Lisp Cookbook 0.1 documentation" href="../index.html" />
    <link rel="up" title="Chapters" href="index.html" />
    <link rel="next" title="Setting up Emacs on Windows or Mac" href="windows.html" />
    <link rel="prev" title="Threads" href="process.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="defining-systems">
<h1>Defining Systems<a class="headerlink" href="#defining-systems" title="Permalink to this headline">¶</a></h1>
<p>A <strong>system</strong> is a collection of Lisp files that together constitute an
application or a library, and that should therefore be managed as a
whole. A <strong>system definition</strong> describes which source files make up the
system, what the dependencies among them are, and the order they should
be compiled and loaded in. You can think of a system definition as an
enhanced version of a Unix makefile, one that uses Lisp objects to
define the systems instead of text files. Unfortunately, system
definition is one of the areas that the CL ANSI standard does not
address, and therefore almost every lisp version has its own version of
a defsystem tool; they all have approximately the same functionality,
but with slightly different syntax.</p>
<div class="section" id="an-example">
<h2>An example<a class="headerlink" href="#an-example" title="Permalink to this headline">¶</a></h2>
<p>This example shows how to use the defsystem facility available in
Allegro Common Lisp 6.x. Suppose you are working on an HTML generation
library, that is composed of three files: &#8220;top.cl&#8221;, that defines a
package for this library, &#8220;html.cl&#8221; that implements the basic
HTML-generating operations, and &#8220;library.cl&#8221; that defines high-level
functions and macros to generate HTML pages. A system definition for
your library might look like this:</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defsystem</span> <span class="p">:</span><span class="n">html</span>
    <span class="p">(:</span><span class="n">pretty</span><span class="o">-</span><span class="n">name</span> <span class="s2">&quot;HTML generation library&quot;</span>
     <span class="p">:</span><span class="n">default</span><span class="o">-</span><span class="n">pathname</span> <span class="c1">#P&quot;/code/lisp/html/&quot;)</span>
  <span class="p">(:</span><span class="n">serial</span> <span class="s2">&quot;top&quot;</span>
           <span class="s2">&quot;html&quot;</span>
           <span class="s2">&quot;library&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The above form defines a system whose name is the symbol <code class="docutils literal"><span class="pre">:html</span></code>.
After the system name comes a list containing optional information: in
this case, we specified a human-readable name for the package, and the
directory where the source files are located. Finally, the three files
that compose the system are listed, with the <code class="docutils literal"><span class="pre">:serial</span></code> keyword
indicating that they should be compiled and loaded in the specified
order (possibly because each one depends on definitions in the previous
ones).</p>
<p>Having defined a system like the above, you can then operate on it. For
example, calling:</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">load</span><span class="o">-</span><span class="n">system</span> <span class="p">:</span><span class="n">html</span> <span class="p">:</span><span class="nb">compile</span> <span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>will cause the three files in the system to be compiled (if needed) and
loaded.</p>
<p>Note that a system can include other systems as components, and the
included systems will be recursively compiled and loaded. For example,
if we wanted the definitions in the <code class="docutils literal"><span class="pre">:util</span></code> system to be available to
the <code class="docutils literal"><span class="pre">:html</span></code> system, we would change the above definition to:</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defsystem</span> <span class="p">:</span><span class="n">html</span>
    <span class="p">(:</span><span class="n">pretty</span><span class="o">-</span><span class="n">name</span> <span class="s2">&quot;HTML generation library&quot;</span>
     <span class="p">:</span><span class="n">default</span><span class="o">-</span><span class="n">pathname</span> <span class="c1">#P&quot;/code/lisp/html/&quot;)</span>
  <span class="p">(:</span><span class="n">serial</span> <span class="p">:</span><span class="n">util</span>
           <span class="s2">&quot;top&quot;</span>
           <span class="s2">&quot;html&quot;</span>
           <span class="s2">&quot;library&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="cross-platform-defsystems">
<h2>Cross-platform defsystems<a class="headerlink" href="#cross-platform-defsystems" title="Permalink to this headline">¶</a></h2>
<p>The most advanced attempt at building a cross-platform system definition
tool is probably <strong>MK-DEFSYSTEM</strong>, available from
<a class="reference external" href="http://sourceforge.net/projects/clocc">CLOCC</a>. Please refer to that
site for more details on how to install it and use it.</p>
</div>
<div class="section" id="system-construction-for-beginners">
<h2>System construction for beginners<a class="headerlink" href="#system-construction-for-beginners" title="Permalink to this headline">¶</a></h2>
<p>Organizing a large Lisp system is not trivial: managing the
interdependencies among a large number of source files and the
interactions between multiple packages can easily turn into a complex
undertaking that requires careful planning. Combine this with the fact
that ANSI CL provides an alternative, although much more limited, way of
managing code
(<code class="docutils literal"><span class="pre">`provide</span></code> &lt;<a class="reference external" href="http://www.lispworks.com/documentation/HyperSpec/Body/f_provid.htm">http://www.lispworks.com/documentation/HyperSpec/Body/f_provid.htm</a>&gt;`__
and
<code class="docutils literal"><span class="pre">`require</span></code> &lt;<a class="reference external" href="http://www.lispworks.com/documentation/HyperSpec/Body/f_provid.htm">http://www.lispworks.com/documentation/HyperSpec/Body/f_provid.htm</a>&gt;`__),
and the whole issue can quickly become a nightmare for beginners. So
here is a suggestion on a possible way to organize your code, one that
works best for small, self-contained packages with a well-defined API,
and that provide functions that might be useful to other parts of a
larger program. Just follow these three easy steps...</p>
<ol class="arabic simple">
<li>Put the following in your Lisp initialization file:</li>
</ol>
<div class="line-block">
<div class="line">~~~lisp</div>
<div class="line">(eval-when (:load-toplevel :execute)</div>
<div class="line">(shadow &#8216;cl:require))</div>
</div>
<div class="line-block">
<div class="line">(defun require (system)</div>
<div class="line">(excl:load-system system :compile t) ; *** ACL specific</div>
<div class="line">(unless (member system <em>modules</em>)</div>
<div class="line">(push system <em>modules</em>)</div>
<div class="line">(when (find-package system)</div>
<div class="line">(use-package system))))</div>
<div class="line">~~~</div>
</div>
<p>The <code class="docutils literal"><span class="pre">load-system</span></code> call is specific to ACL&#8217;s defsystem, so you should
replace it with the equivalent call for the defsystem you are using.</p>
<ol class="arabic simple">
<li>Write your code so that it creates its own package, and exports all
public symbols from it. Using the <code class="docutils literal"><span class="pre">:html</span></code> system defined above as
an example:</li>
</ol>
<div class="line-block">
<div class="line">~~~lisp</div>
<div class="line">(defpackage :html</div>
<div class="line">(:use :lisp)</div>
<div class="line">(:export &#8220;ANCHOR&#8221; &#8220;HEADER&#8221; ...))</div>
<div class="line">~~~</div>
</div>
<ol class="arabic simple">
<li>Write a system definition for your code, giving the system the same
name you used for the package (like the <code class="docutils literal"><span class="pre">defsystem</span></code> form for
<code class="docutils literal"><span class="pre">:html</span></code> at the beginning of this chapter).</li>
</ol>
<p>Now you can simply call</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="p">(</span><span class="n">require</span> <span class="p">:</span><span class="n">html</span><span class="p">)</span>
</pre></div>
</div>
<p>and the system will be compiled (if needed) and loaded; moreover, all of
its external symbols will be imported into the current package. If you
later modify your code, you just have to call
<code class="docutils literal"><span class="pre">`require</span></code> &lt;<a class="reference external" href="http://www.lispworks.com/documentation/HyperSpec/Body/f_provid.htm">http://www.lispworks.com/documentation/HyperSpec/Body/f_provid.htm</a>&gt;`__
again, and the system will be recompiled and reloaded. This behaves
approximately like the <code class="docutils literal"><span class="pre">use</span></code> command in Perl or the <code class="docutils literal"><span class="pre">import</span></code>
statement in Java: it allows you to easily access the functionality
provided by a Lisp package with a single command.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Defining Systems</a><ul>
<li><a class="reference internal" href="#an-example">An example</a></li>
<li><a class="reference internal" href="#cross-platform-defsystems">Cross-platform defsystems</a></li>
<li><a class="reference internal" href="#system-construction-for-beginners">System construction for beginners</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Chapters</a><ul>
      <li>Previous: <a href="process.html" title="previous chapter">Threads</a></li>
      <li>Next: <a href="windows.html" title="next chapter">Setting up Emacs on Windows or Mac</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/chapters/systems.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, cl-cookbook contributors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../_sources/chapters/systems.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>