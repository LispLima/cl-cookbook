<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Dates and Times &#8212; The Common Lisp Cookbook 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="The Common Lisp Cookbook 0.1 documentation" href="../index.html" />
    <link rel="up" title="Chapters" href="index.html" />
    <link rel="next" title="Hash Tables" href="hashes.html" />
    <link rel="prev" title="Strings" href="strings.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="dates-and-times">
<h1>Dates and Times<a class="headerlink" href="#dates-and-times" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line">Common Lisp provides two different ways of looking at time: universal
time,</div>
<div class="line">meaning time in the &#8220;real world&#8221;, and run time, meaning time as seen
by your</div>
<div class="line">computer&#8217;s CPU. We will deal with both of them separately.</div>
</div>
<div class="section" id="universal-time">
<h2>Universal Time<a class="headerlink" href="#universal-time" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Universal time is represented as the number of seconds that have
elapsed since</div>
<div class="line">00:00 of January 1, 1900 in the GMT time zone. The function</div>
<div class="line"><code class="docutils literal"><span class="pre">`GET-UNIVERSAL-TIME</span></code> &lt;<a class="reference external" href="http://www.lispworks.com/documentation/HyperSpec/Body/f_get_un.htm">http://www.lispworks.com/documentation/HyperSpec/Body/f_get_un.htm</a>&gt;`__</div>
<div class="line">returns the current universal time:</div>
</div>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">get</span><span class="o">-</span><span class="n">universal</span><span class="o">-</span><span class="n">time</span><span class="p">)</span>
<span class="mi">3220993326</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Of course this value is not very readable, so you can use the function</div>
<div class="line"><code class="docutils literal"><span class="pre">`DECODE-UNIVERSAL-TIME</span></code> &lt;<a class="reference external" href="http://www.lispworks.com/documentation/HyperSpec/Body/f_dec_un.htm">http://www.lispworks.com/documentation/HyperSpec/Body/f_dec_un.htm</a>&gt;`__</div>
<div class="line">to turn it into a &#8220;calendar time&#8221; representation:</div>
</div>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">decode</span><span class="o">-</span><span class="n">universal</span><span class="o">-</span><span class="n">time</span> <span class="mi">3220993326</span><span class="p">)</span>
<span class="mi">6</span>
<span class="mi">22</span>
<span class="mi">19</span>
<span class="mi">25</span>
<span class="mi">1</span>
<span class="mi">2002</span>
<span class="mi">4</span>
<span class="n">NIL</span>
<span class="mi">5</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">This call returns nine values: seconds, minutes, hours, day, month,
year, day of</div>
<div class="line">the week, daylight savings time flag and time zone. Note that the day
of the</div>
<div class="line">week is represented as an integer in the range 0..6 with 0 being
Monday and 6</div>
<div class="line">being Sunday. Also, the time zone is represented as the number of
hours you need</div>
<div class="line">to add to the current time in order to get GMT time. So in this
example the</div>
<div class="line">decoded time would be 19:22:06 of Friday, January 25, 2002, in the EST
time</div>
<div class="line">zone, with no daylight savings in effect. This, of course, relies on
the</div>
<div class="line">computer&#8217;s own clock, so make sure that it is set correctly (including
the time</div>
<div class="line">zone you are in and the DST flag). As a shortcut, you can use</div>
<div class="line"><code class="docutils literal"><span class="pre">`GET-DECODED-TIME</span></code> &lt;<a class="reference external" href="http://www.lispworks.com/documentation/HyperSpec/Body/f_get_un.htm">http://www.lispworks.com/documentation/HyperSpec/Body/f_get_un.htm</a>&gt;`__</div>
<div class="line">to get the calendar time representation of the current time directly:</div>
</div>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">get</span><span class="o">-</span><span class="n">decoded</span><span class="o">-</span><span class="n">time</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">decode</span><span class="o">-</span><span class="n">universal</span><span class="o">-</span><span class="n">time</span> <span class="p">(</span><span class="n">get</span><span class="o">-</span><span class="n">universal</span><span class="o">-</span><span class="n">time</span><span class="p">))</span>
</pre></div>
</div>
<p>Here is an example of how to use these functions in a program:</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">defconstant</span> <span class="o">*</span><span class="n">day</span><span class="o">-</span><span class="n">names</span><span class="o">*</span>
           <span class="s1">&#39;(&quot;Monday&quot; &quot;Tuesday&quot; &quot;Wednesday&quot;</span>
             <span class="s2">&quot;Thursday&quot;</span> <span class="s2">&quot;Friday&quot;</span> <span class="s2">&quot;Saturday&quot;</span>
             <span class="s2">&quot;Sunday&quot;</span><span class="p">))</span>
<span class="o">*</span><span class="n">DAY</span><span class="o">-</span><span class="n">NAMES</span><span class="o">*</span>

<span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">multiple</span><span class="o">-</span><span class="n">value</span><span class="o">-</span><span class="n">bind</span>
           <span class="p">(</span><span class="n">second</span> <span class="n">minute</span> <span class="n">hour</span> <span class="n">date</span> <span class="n">month</span> <span class="n">year</span> <span class="n">day</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">week</span> <span class="n">dst</span><span class="o">-</span><span class="n">p</span> <span class="n">tz</span><span class="p">)</span>
           <span class="p">(</span><span class="n">get</span><span class="o">-</span><span class="n">decoded</span><span class="o">-</span><span class="n">time</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">format</span> <span class="n">t</span> <span class="s2">&quot;It is now ~2,&#39;0d:~2,&#39;0d:~2,&#39;0d of ~a, ~d/~2,&#39;0d/~d (GMT~@d)&quot;</span>
             <span class="n">hour</span>
             <span class="n">minute</span>
             <span class="n">second</span>
             <span class="p">(</span><span class="n">nth</span> <span class="n">day</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">week</span> <span class="o">*</span><span class="n">day</span><span class="o">-</span><span class="n">names</span><span class="o">*</span><span class="p">)</span>
             <span class="n">month</span>
             <span class="n">date</span>
             <span class="n">year</span>
             <span class="p">(</span><span class="o">-</span> <span class="n">tz</span><span class="p">)))</span>
<span class="n">It</span> <span class="ow">is</span> <span class="n">now</span> <span class="mi">17</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">17</span> <span class="n">of</span> <span class="n">Saturday</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">26</span><span class="o">/</span><span class="mi">2002</span> <span class="p">(</span><span class="n">GMT</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Of course the call to <code class="docutils literal"><span class="pre">GET-DECODED-TIME</span></code> above could be replaced by</div>
<div class="line"><code class="docutils literal"><span class="pre">(DECODE-UNIVERSAL-TIME</span> <span class="pre">n)</span></code>, where n is any integer number, to print
an</div>
<div class="line">arbitrary date. You can also go the other way around: the function</div>
<div class="line"><code class="docutils literal"><span class="pre">`ENCODE-UNIVERSAL-TIME</span></code> &lt;<a class="reference external" href="http://www.lispworks.com/documentation/HyperSpec/Body/f_encode.htm">http://www.lispworks.com/documentation/HyperSpec/Body/f_encode.htm</a>&gt;`__</div>
<div class="line">lets you encode a calendar time into the corresponding universal time.
This</div>
<div class="line">function takes six mandatory arguments (seconds, minutes, hours, date,
month and</div>
<div class="line">year) and one optional argument (the time zone) and it returns a
universal time:</div>
</div>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">encode</span><span class="o">-</span><span class="n">universal</span><span class="o">-</span><span class="n">time</span> <span class="mi">6</span> <span class="mi">22</span> <span class="mi">19</span> <span class="mi">25</span> <span class="mi">1</span> <span class="mi">2002</span><span class="p">)</span>
<span class="mi">3220993326</span>
</pre></div>
</div>
<p>Note that the result is automatically adjusted for daylight savings time
if the time zone is not supplied. If it is supplied, than Lisp assumes
that the specified time zone already accounts for daylight savings time,
and no adjustment is performed.</p>
<p>Since universal times are simply numbers, they are easier and safer to
manipulate than calendar times. Dates and times should always be stored
as universal times if possibile, and only converted to string
representations for output purposes. For example, it is straightforward
to know which of two dates came before the other, by simply comparing
the two corresponding universal times with &lt;. Another typical problem is
how to compute the &#8220;temporal distance&#8221; between two given dates. Let&#8217;s
see how to do this with an example: specifically, we will calculate the
temporal distance between the first landing on the moon (4:17pm EDT,
July 20 1969) and the last takeoff of the space shuttle Challenger
(11:38 a.m. EST, January 28, 1986).</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">setq</span> <span class="o">*</span><span class="n">moon</span><span class="o">*</span> <span class="p">(</span><span class="n">encode</span><span class="o">-</span><span class="n">universal</span><span class="o">-</span><span class="n">time</span> <span class="mi">0</span> <span class="mi">17</span> <span class="mi">16</span> <span class="mi">20</span> <span class="mi">7</span> <span class="mi">1969</span> <span class="mi">4</span><span class="p">))</span>
<span class="mi">2194805820</span>

<span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">setq</span> <span class="o">*</span><span class="n">takeoff</span><span class="o">*</span> <span class="p">(</span><span class="n">encode</span><span class="o">-</span><span class="n">universal</span><span class="o">-</span><span class="n">time</span> <span class="mi">0</span> <span class="mi">38</span> <span class="mi">11</span> <span class="mi">28</span> <span class="mi">1</span> <span class="mi">1986</span> <span class="mi">5</span><span class="p">))</span>
<span class="mi">2716303080</span>

<span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">-</span> <span class="o">*</span><span class="n">takeoff</span><span class="o">*</span> <span class="o">*</span><span class="n">moon</span><span class="o">*</span><span class="p">)</span>
<span class="mi">521497260</span>
</pre></div>
</div>
<p>That&#8217;s a bit over 52 million seconds, corresponding to 6035 days, 20
hours and 21 minutes (you can verify this by dividing that number by 60,
60 and 24 in succession). Going beyond days is a bit harder because
months and years don&#8217;t have a fixed length, but the above is
approximately 16 and a half years.</p>
<p>You can in theory use differences between universal times to measure how
long the execution of a part of your program took, but the universal
times are represented in seconds, and this resolution will usually be
too low to be useful. We will see a better method of doing this in the
section about internal time.</p>
<p>To sum up, we have seen how to turn a universal time into a calendar
time and vice-versa, how to perform calculations on universal times, and
how to format calendar times in a human-readable way. The last piece
that is missing is how to parse a string represented as a human-readable
string (e.g. &#8220;03/11/1997&#8221;) and turn it into a calendar time.
Unfortunately this turns out to be very difficult in the general case,
due to the multitude of different ways of writing dates and times that
we use. In some cases it might not even be possible without context
information: the above example can be correctly parsed both as March
11th or as November 3rd according to where you are living. In
conclusion, either force your users to write dates in a fixed format, or
be prepared to write a very intelligent parsing function!</p>
<div class="section" id="internal-time">
<h3>Internal Time<a class="headerlink" href="#internal-time" title="Permalink to this headline">¶</a></h3>
<p>Internal time is the time as measured by your Lisp environment, using
your computer&#8217;s clock. It differs from universal time in three important
respects. First, internal time is not measured starting from a specified
point in time: it could be measured from the instant you started your
Lisp, from the instant you booted your machine, or from any other
arbitrary time point in the past. As we will see shortly, the absolute
value of an internal time is almost always meaningless; only differences
between internal times are useful. The second difference is that
internal time is not measured in seconds, but in a (usually smaller)
unit whose value can be deduced from
<code class="docutils literal"><span class="pre">`INTERNAL-TIME-UNITS-PER-SECOND</span></code> &lt;<a class="reference external" href="http://www.lispworks.com/documentation/HyperSpec/Body/v_intern.htm">http://www.lispworks.com/documentation/HyperSpec/Body/v_intern.htm</a>&gt;`__:</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="n">internal</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="n">units</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">second</span>
<span class="mi">1000</span>
</pre></div>
</div>
<p>This means that in the Lisp environment used in this example, internal
time is measured in milliseconds. Finally, what is being measured by the
&#8220;internal time&#8221; clock? There are actually two different internal time
clocks in your Lisp: one of them meaures the passage of &#8220;real&#8221; time (the
same time that universal time measures, but in different units), and the
other one measures the passage of CPU time, that is, the time your CPU
spends doing actual computation for the current Lisp process. On most
modern computers these two times will be different, since your CPU will
never be entirely dedicated to your program (even on single-user
machines, the CPU has to devote part of its time to processing
interrupts, performing I/O, etc). The two functions used to retrieve
internal times are called
<code class="docutils literal"><span class="pre">`GET-INTERNAL-REAL-TIME</span></code> &lt;<a class="reference external" href="http://www.lispworks.com/documentation/HyperSpec/Body/f_get_in.htm">http://www.lispworks.com/documentation/HyperSpec/Body/f_get_in.htm</a>&gt;`__
and
<code class="docutils literal"><span class="pre">`GET-INTERNAL-RUN-TIME</span></code> &lt;<a class="reference external" href="http://www.lispworks.com/documentation/HyperSpec/Body/f_get__1.htm">http://www.lispworks.com/documentation/HyperSpec/Body/f_get__1.htm</a>&gt;`__
respectively. Using them, we can solve the above problem about measuring
a function&#8217;s run time:</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">let</span> <span class="p">((</span><span class="n">real1</span> <span class="p">(</span><span class="n">get</span><span class="o">-</span><span class="n">internal</span><span class="o">-</span><span class="n">real</span><span class="o">-</span><span class="n">time</span><span class="p">))</span>
               <span class="p">(</span><span class="n">run1</span> <span class="p">(</span><span class="n">get</span><span class="o">-</span><span class="n">internal</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="n">time</span><span class="p">)))</span>
           <span class="p">(</span><span class="o">...</span> <span class="n">your</span> <span class="n">call</span> <span class="n">here</span> <span class="o">...</span><span class="p">)</span>
           <span class="p">(</span><span class="n">let</span> <span class="p">((</span><span class="n">run2</span> <span class="p">(</span><span class="n">get</span><span class="o">-</span><span class="n">internal</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="n">time</span><span class="p">))</span>
                 <span class="p">(</span><span class="n">real2</span> <span class="p">(</span><span class="n">get</span><span class="o">-</span><span class="n">internal</span><span class="o">-</span><span class="n">real</span><span class="o">-</span><span class="n">time</span><span class="p">)))</span>
             <span class="p">(</span><span class="nb">format</span> <span class="n">t</span> <span class="s2">&quot;Computation took:~%&quot;</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">format</span> <span class="n">t</span> <span class="s2">&quot;  ~f seconds of real time~%&quot;</span>
               <span class="p">(</span><span class="o">/</span> <span class="p">(</span><span class="o">-</span> <span class="n">real2</span> <span class="n">real1</span><span class="p">)</span> <span class="n">internal</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="n">units</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">second</span><span class="p">))</span>
             <span class="p">(</span><span class="nb">format</span> <span class="n">t</span> <span class="s2">&quot;  ~f seconds of run time~%&quot;</span>
               <span class="p">(</span><span class="o">/</span> <span class="p">(</span><span class="o">-</span> <span class="n">run2</span> <span class="n">run1</span><span class="p">)</span> <span class="n">internal</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="n">units</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">second</span><span class="p">))))</span>
</pre></div>
</div>
<p>A good way to see the difference between real time and run time is to
test the above code using a call such as <code class="docutils literal"><span class="pre">(SLEEP</span> <span class="pre">3)</span></code>. The
<code class="docutils literal"><span class="pre">`SLEEP</span></code> &lt;<a class="reference external" href="http://www.lispworks.com/documentation/HyperSpec/Body/f_sleep.htm">http://www.lispworks.com/documentation/HyperSpec/Body/f_sleep.htm</a>&gt;`__
function suspends the execution of your code for the specified number of
seconds. You should therefore see a real time very close to the argument
of <code class="docutils literal"><span class="pre">SLEEP</span></code> and a run time very close to zero. Let&#8217;s turn the above
code into a macro in order to make it more general:</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span>CL-USER&gt; (defmacro timing (&amp;body forms)
           (let ((real1 (gensym))
                 (real2 (gensym))
                 (run1 (gensym))
                 (run2 (gensym))
                 (result (gensym)))
             `(let* ((,real1 (get-internal-real-time))
                     (,run1 (get-internal-run-time))
                     (,result (progn ,@forms))
                     (,run2 (get-internal-run-time))
                     (,real2 (get-internal-real-time)))
               (format *debug-io* &quot;;;; Computation took:~%&quot;)
               (format *debug-io* &quot;;;;  ~f seconds of real time~%&quot;
                 (/ (- ,real2 ,real1) internal-time-units-per-second))
               (format t &quot;;;;  ~f seconds of run time~%&quot;
                 (/ (- ,run2 ,run1) internal-time-units-per-second))
        ,result)))
TIMING

CL-USER&gt; (timing (sleep 1))
;;; Computation took: 0.994 seconds of real time 0.0 seconds of run
;;; time
NIL
</pre></div>
</div>
<p>The built-in macro
<code class="docutils literal"><span class="pre">`TIME</span></code> &lt;<a class="reference external" href="http://www.lispworks.com/documentation/HyperSpec/Body/m_time.htm">http://www.lispworks.com/documentation/HyperSpec/Body/m_time.htm</a>&gt;`__
does roughly the same as the above macro (it executes a form and prints
timing information at the end), but it also usually provides information
about memory usage, time spent in garbage collection, page faults, etc.
The format of the output is implementation-dependent, but in general
it&#8217;s pretty useful and informative. This is an example under Allegro
Common Lisp 6.0: we generate a list of 100 real numbers and we measure
the time it takes to sort them in ascending order.</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">let</span> <span class="p">((</span><span class="n">numbers</span> <span class="p">(</span><span class="n">loop</span> <span class="k">for</span> <span class="n">i</span> <span class="kn">from</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">100</span> <span class="n">collect</span> <span class="p">(</span><span class="n">random</span> <span class="mf">1.0</span><span class="p">))))</span>
           <span class="p">(</span><span class="n">time</span> <span class="p">(</span><span class="n">sort</span> <span class="n">numbers</span> <span class="c1">#&#39;&lt;)))</span>
<span class="p">;</span> <span class="n">cpu</span> <span class="n">time</span> <span class="p">(</span><span class="n">non</span><span class="o">-</span><span class="n">gc</span><span class="p">)</span> <span class="mi">0</span> <span class="n">msec</span> <span class="n">user</span><span class="p">,</span> <span class="mi">10</span> <span class="n">msec</span> <span class="n">system</span>
<span class="p">;</span> <span class="n">cpu</span> <span class="n">time</span> <span class="p">(</span><span class="n">gc</span><span class="p">)</span>     <span class="mi">0</span> <span class="n">msec</span> <span class="n">user</span><span class="p">,</span> <span class="mi">0</span> <span class="n">msec</span> <span class="n">system</span>
<span class="p">;</span> <span class="n">cpu</span> <span class="n">time</span> <span class="p">(</span><span class="n">total</span><span class="p">)</span>  <span class="mi">0</span> <span class="n">msec</span> <span class="n">user</span><span class="p">,</span> <span class="mi">10</span> <span class="n">msec</span> <span class="n">system</span>
<span class="p">;</span> <span class="n">real</span> <span class="n">time</span>  <span class="mi">9</span> <span class="n">msec</span>
<span class="p">;</span> <span class="n">space</span> <span class="n">allocation</span><span class="p">:</span>
<span class="p">;</span>  <span class="mi">3</span><span class="p">,</span><span class="mi">586</span> <span class="n">cons</span> <span class="n">cells</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span><span class="mi">704</span> <span class="n">other</span> <span class="nb">bytes</span><span class="p">,</span> <span class="mi">0</span> <span class="n">static</span> <span class="nb">bytes</span>
</pre></div>
</div>
</div>
<div class="section" id="computing-the-day-of-the-week">
<h3>Computing the day of the week<a class="headerlink" href="#computing-the-day-of-the-week" title="Permalink to this headline">¶</a></h3>
<p>In the section about <a class="reference external" href="#univ">Universal Time</a> we&#8217;ve learned enough to
write a small function that computes the day of the week. Unfortunately,
by definition, this function won&#8217;t work for dates before January 1,
1900.</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">defun</span> <span class="n">day</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">week</span> <span class="p">(</span><span class="n">day</span> <span class="n">month</span> <span class="n">year</span><span class="p">)</span>
           <span class="s2">&quot;Returns the day of the week as an integer. Monday is 0.&quot;</span>
           <span class="p">(</span><span class="n">nth</span><span class="o">-</span><span class="n">value</span>
             <span class="mi">6</span>
             <span class="p">(</span><span class="n">decode</span><span class="o">-</span><span class="n">universal</span><span class="o">-</span><span class="n">time</span>
               <span class="p">(</span><span class="n">encode</span><span class="o">-</span><span class="n">universal</span><span class="o">-</span><span class="n">time</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="n">day</span> <span class="n">month</span> <span class="n">year</span> <span class="mi">0</span><span class="p">)</span>
         <span class="mi">0</span><span class="p">)))</span>
<span class="n">DAY</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">WEEK</span>
<span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">day</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">week</span> <span class="mi">23</span> <span class="mi">12</span> <span class="mi">1965</span><span class="p">)</span>
<span class="mi">3</span>
<span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">day</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">week</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1900</span><span class="p">)</span>
<span class="mi">0</span>
<span class="n">CL</span><span class="o">-</span><span class="n">USER</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">day</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">week</span> <span class="mi">31</span> <span class="mi">12</span> <span class="mi">1899</span><span class="p">)</span>

<span class="n">Type</span><span class="o">-</span><span class="n">error</span> <span class="ow">in</span> <span class="n">KERNEL</span><span class="p">::</span><span class="n">OBJECT</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">TYPE</span><span class="o">-</span><span class="n">ERROR</span><span class="o">-</span><span class="n">HANDLER</span><span class="p">:</span>
   <span class="mi">1899</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">of</span> <span class="nb">type</span> <span class="p">(</span><span class="n">OR</span> <span class="p">(</span><span class="n">MOD</span> <span class="mi">100</span><span class="p">)</span> <span class="p">(</span><span class="n">INTEGER</span> <span class="mi">1900</span><span class="p">))</span>
</pre></div>
</div>
<p>If this is a problem for you, here&#8217;s a small function by Gerald Doussot
(adapted from the comp.lang.c FAQ) that will help you:</p>
<div class="code lisp highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defun</span> <span class="n">day</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">week</span> <span class="p">(</span><span class="n">day</span> <span class="n">month</span> <span class="n">year</span><span class="p">)</span>
  <span class="s2">&quot;Returns the day of the week as an integer. Sunday is 0. Works for years after 1752.&quot;</span>
  <span class="p">(</span><span class="n">let</span> <span class="p">((</span><span class="n">offset</span> <span class="s1">&#39;(0 3 2 5 0 3 5 1 4 6 2 4)))</span>
    <span class="p">(</span><span class="n">when</span> <span class="p">(</span><span class="o">&lt;</span> <span class="n">month</span> <span class="mi">3</span><span class="p">)</span>
      <span class="p">(</span><span class="n">decf</span> <span class="n">year</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="n">mod</span>
     <span class="p">(</span><span class="n">truncate</span> <span class="p">(</span><span class="o">+</span> <span class="n">year</span>
                  <span class="p">(</span><span class="o">/</span> <span class="n">year</span> <span class="mi">4</span><span class="p">)</span>
                  <span class="p">(</span><span class="o">/</span> <span class="p">(</span><span class="o">-</span> <span class="n">year</span><span class="p">)</span>
                     <span class="mi">100</span><span class="p">)</span>
                  <span class="p">(</span><span class="o">/</span> <span class="n">year</span> <span class="mi">400</span><span class="p">)</span>
                  <span class="p">(</span><span class="n">nth</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">month</span><span class="p">)</span> <span class="n">offset</span><span class="p">)</span>
                  <span class="n">day</span>
                  <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
     <span class="mi">7</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Dates and Times</a><ul>
<li><a class="reference internal" href="#universal-time">Universal Time</a><ul>
<li><a class="reference internal" href="#internal-time">Internal Time</a></li>
<li><a class="reference internal" href="#computing-the-day-of-the-week">Computing the day of the week</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Chapters</a><ul>
      <li>Previous: <a href="strings.html" title="previous chapter">Strings</a></li>
      <li>Next: <a href="hashes.html" title="next chapter">Hash Tables</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/chapters/dates_and_times.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, cl-cookbook contributors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../_sources/chapters/dates_and_times.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>